{% extends 'base.html' %}
{% block content %}
{% if user.is_authenticated %}
<div class="deck-page">
  <div class="deck-container">
    <h1>{{ deck.nome }}</h1>
    <div class="card-display">
      <div id="card" class="card" onclick="flipCard()">
        <div class="card-content">
          <p id="card-content">
            {% if cards %}
                {{ cards.0.lado_frente }}
            {% else %}
                Nenhum card dispon√≠vel.
            {% endif %}
          </p>
        </div>
      </div>
      <p class="card-hint" id="card-hint">Clique no cart√£o para vir√°-lo</p>
    </div>
    <div class="controls">
      <button id="prev-card-btn" class="control-btn" onclick="prevCard()">‚Üê</button>
      <button id="next-card-btn" class="control-btn" onclick="nextCard()">‚Üí</button>
    </div>
    <div class="actions">
      <button id="incorrect-btn" class="action-btn">‚úò</button>
      <button id="mic-btn" class="action-btn">üé§</button>
      <button id="correct-btn" class="action-btn">‚úî</button>
    </div>
    <a href="{% url 'classes:create_card' deck.id %}" class="add-card-btn">Adicionar Novo Card</a>
  </div>
</div>

<script id="cards-data" type="application/json">
    {{ cards|safe }}
</script>

<script>
    // Verifica√ß√£o e inicializa√ß√£o da vari√°vel cards
    let cards; // Declare `cards` apenas uma vez.
  
    const rawCards = document.getElementById('cards-data').textContent;
  
    try {
        cards = JSON.parse(rawCards); // Tenta transformar o JSON do script em um array
    } catch (e) {
        console.error('Erro ao analisar JSON:', e); // Loga o erro caso o JSON esteja malformado
        cards = []; // Inicializa como lista vazia se houver erro
    }
  
    console.log('Cards carregados:', cards); // Para verificar no console do navegador
  
    // Outras vari√°veis globais necess√°rias
    let currentIndex = 0;
    const cardContent = document.getElementById('card-content');
    const cardHint = document.getElementById('card-hint');
    let isFront = true;
  
    // Fun√ß√µes
    function updateCard() {
        if (cards.length > 0) {
            const card = cards[currentIndex];
            cardContent.textContent = isFront ? card.lado_frente : card.lado_tras;
            cardHint.textContent = isFront
                ? "Clique no cart√£o para vir√°-lo ‚Üí"
                : "Clique novamente para voltar ‚Üí";
        } else {
            cardContent.textContent = "Nenhum card dispon√≠vel";
            cardHint.textContent = "";
        }
    }
  
    function flipCard() {
        isFront = !isFront;
        updateCard();
    }
  
    function nextCard() {
        console.log('Avan√ßando para o pr√≥ximo card...');
        console.log('√çndice atual antes de avan√ßar:', currentIndex);
  
        if (currentIndex < cards.length - 1) {
            currentIndex++;
            console.log('√çndice atual depois de avan√ßar:', currentIndex);
            updateCard();
        } else {
            console.log('Voc√™ j√° est√° no √∫ltimo card.');
        }
    }
  
    function prevCard() {
        console.log('Voltando para o card anterior...');
        console.log('√çndice atual antes de voltar:', currentIndex);
  
        if (currentIndex > 0) {
            currentIndex--;
            console.log('√çndice atual depois de voltar:', currentIndex);
            updateCard();
        } else {
            console.log('Voc√™ j√° est√° no primeiro card.');
        }
    }
  
    // Inicializa o primeiro card
    updateCard();
  </script>

{% else %}
  <p>Voc√™ n√£o est√° logado.</p>
  <br>
  <a href="{% url 'accounts:login' %}" class="botaozinho">Fa√ßa login aqui</a>
{% endif %}
{% endblock content %}